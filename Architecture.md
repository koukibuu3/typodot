# タイピングソフト開発 計画書（ミニマム・シンプル版）

## 1. プロダクト概要

### 目的
- 入力遅延を極限まで減らした「純粋なタイピング練習ツール」を提供する。

### ターゲットユーザー
- Macユーザー
- タイピング速度向上を目指す初〜中級者

### 最重要ゴール
- 取りこぼしゼロのキー入力
- 入力遅延の体感ゼロ
- シンプルで集中できる画面構成

---

## 2. 技術構成（ミニマム版）

### UI → SwiftUI
- 学習コストが低く保守しやすい

### 入力処理 → AppKit（NSView）
- 高速な keyDown イベント処理を担当
- SwiftUI は最小限の更新に限定

### 選択理由
- SwiftUI 単独ではリアルタイム入力に不安があるため
- AppKit の低レイヤ処理を“キー入力のみ”に限定して複雑性を抑える

---

## 3. 実装範囲と非対象機能

### 採用する機能（必要最小）
1. タイピング練習画面
2. 練習テキスト（固定 or 少数パターン）
3. 正誤判定
4. WPM・精度・経過時間の計測
5. 結果画面

### 今回は削除する機能
- サウンド
- 入力方式の選択
- 複雑な設定画面
- 履歴管理
- グラフ
- テキスト外部読み込み
- オンライン機能
- マルチデバイス展開
- テーマ切替
- カスタムモード
- CLI化
- 拡張API

---

## 4. アーキテクチャ方針（簡潔化）
- AppKit：キー入力のキャプチャ（1ファイル）
- Swift Engine：判定ロジック
- SwiftUI：画面表示

### 役割分担
- **AppKit**：keyDownイベント取得 → Engineへ渡す
  - `NSEvent.addLocalMonitorForEvents` を使用し、First Responder に依存しない実装とする
- **TypingEngine**：正誤判定・インデックス進行・スコア更新
- **SwiftUI**：必要最低限のUI更新

### 対応テキスト
- **英字テキストのみ**（アルファベット・数字・記号）
- 日本語ローマ字入力は将来対応（複数入力パターンの判定が複雑なため）

### ポイント
- UIアニメーションは最小限
- 状態管理は1つの ObservableObject に集約
- 再描画回数を抑え応答性を最優先

### タイマー実装
- 経過時間計測には `DispatchSourceTimer` を使用（精度と負荷のバランス）
- UI更新は100ms間隔程度に抑制し、タイピング応答性を優先

---

## 5. 画面構成（極シンプル）

### 1）ホーム
- 「練習開始」ボタンのみ
- ※必要ならテキスト選択を少数追加

### 2）タイピング画面
- 練習テキストの表示
- 正誤のリアルタイム反映（色変更）
- スコアの更新（WPM・精度・経過時間）

### 3）結果画面
- WPM
- 精度
- 経過時間
- 「ホームへ戻る」

---

## 6. 優先順位（迷いを防ぐ指針）

1. **応答性**  
   - 処理負荷が高い機能は常に後回し、または排除

2. **安定性**  
   - 外部ファイルやネットワーク通信は採用しない

3. **UIの見やすさ**  
   - モードや設定を廃止して画面構成を簡潔に

---

## 7. ディレクトリ構造（ミニマム版）

```
TypingApp/
├── TypingApp.swift
├── AppState.swift
├── Views/
│   ├── HomeView.swift
│   ├── TypingView.swift
│   ├── ResultView.swift
├── Engine/
│   ├── TypingEngine.swift
│   ├── Scoring.swift
├── AppKitBridge/
│   └── TypingCaptureView.swift
└── Resources/
    └── texts.json  ※ Bundle埋め込みリソースとして使用
```

---

## 8. 開発フェーズ（最短・最小ステップ）

1. SwiftUI でホーム / タイピング / 結果のモック作成  
2. AppKit の NSView でキー入力キャプチャ  
3. TypingEngine の最小実装（正誤・インデックス進行）  
4. SwiftUI と連携してリアルタイム反映  
5. 結果画面作成  
6. 遅延計測と最適化

---
